package com.cmc.evaluacion.fase2.servicios;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.util.Date;

import com.cmc.commons.util.DateUtil;
import com.cmc.commons.util.TipoPrestamo;
import com.cmc.evaluacion.fase2.entidades.Cartera;
import com.cmc.evaluacion.fase2.entidades.Cliente;
import com.cmc.evaluacion.fase2.entidades.Prestamo;
import com.cmc.excepciones.EvaluacionException;

public class AdminPrestamos {
	
	public void colocarPrestamos(String rutaArchivo, Cartera cartera){
		File file = new File(rutaArchivo);
		FileReader fReader = null;
		BufferedReader bReader = null;
		String lineas = "";
		try {
			fReader = new FileReader(file);
			bReader = new BufferedReader(fReader);
			while ((lineas = bReader.readLine()) != null) {
				armarPrestamo(lineas, cartera);
			}
		} catch (FileNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		
	}
	
	private static void armarPrestamo(String linea, Cartera cartera) throws EvaluacionException{
		String cedula;
		double monto;
		String pCaracter, fecha;
		String[] datos;
		Date fechaNueva;
		datos = linea.split("-");
		cedula = datos[0];
		pCaracter = datos[1].substring(0,1);
		fecha = datos[2];
		monto = Double.parseDouble(datos[3]);
		Cliente recuperarCliente = cartera.buscarCliente(cedula);
		if(recuperarCliente != null){
			//recuperarCliente
			Prestamo prestamo = new Prestamo(pCaracter,cedula);
			if(TipoPrestamo.HIPOTECARIO.equals(pCaracter)){
				recuperarCliente.agregarPrestamo(prestamo);
				DateUtil.convertir(fecha);
			}else if(TipoPrestamo.QUIROGRAFARIO.equals(pCaracter)){
				DateUtil.convertir(fecha);
			}else{
				
			}
		}else{
			throw new EvaluacionException("No se encontro al usuario con cedula");
		}
		
		
	}

}
